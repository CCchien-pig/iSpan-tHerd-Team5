@using tHerdBackend.Core.DTOs
@using tHerdBackend.Core.DTOs.PROD
@model IEnumerable<ProductImageDto>

<div class="mb-3">
    <label class="form-label fw-bold">產品圖片</label>

    <!-- 🔹 上傳按鈕 -->
    @await Component.InvokeAsync("UploadImageModal", new {
        moduleId = "PROD",
        progId = "Products",
        modalId = "uploadImageModal"
        })

    <!-- 🔹 舊有圖片清單 -->
    <div class="mt-3">
        <h6 class="fw-bold">已上傳圖片</h6>
        <div id="existingImages" class="d-flex flex-wrap gap-3">
            @if (Model != null && Model.Any())
            {
                foreach (var img in Model)
                {
                    <div class="position-relative" style="width:120px; height:120px;">
                        <img src="@img.FileUrl"
                             alt="@img.AltText"
                             class="img-thumbnail w-100 h-100"
                             style="object-fit:cover;" />

                        <!-- 編輯 -->
                        <button type="button"
                                class="btn btn-sm btn-outline-primary position-absolute bottom-0 start-0"
                                onclick="openUpdateImageModal(@img.ImageId)">
                            <i class="bi bi-pencil"></i>
                        </button>

                        <!-- 刪除 -->
                        <button type="button"
                                class="btn btn-sm btn-danger position-absolute top-0 end-0"
                                data-img-id="@img.ImageId"
                                onclick="removeExistingImage(this)">
                            <i class="bi bi-x"></i>
                        </button>
                    </div>
                }
            }
            else
            {
                <span class="text-muted">尚未上傳圖片</span>
            }
        </div>
    </div>
</div>

<!-- 🔹 編輯圖片資訊 Modal -->
@await Component.InvokeAsync("UpdateImage", new {
modalId = "imgMetaModal",
    title = "圖片資訊",
    file = new SysAssetFileDto(),
    updateApiUrl = "/SYS/Images/UpdateFile",
    deleteApiUrl = "/SYS/Images/DeleteFile"
})
