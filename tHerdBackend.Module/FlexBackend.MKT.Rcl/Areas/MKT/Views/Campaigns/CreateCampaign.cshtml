@model FlexBackend.Infra.Models.MktCampaign

@{
    ViewData["Title"] = "活動新增";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<form id="campaignForm" class="container my-4">
    <div class="mb-3">
        <label>活動名稱</label>
        <input type="text" class="form-control" name="CampaignName" required />
    </div>

    <div class="mb-3">
        <label>活動類型</label>
        <select class="form-select" name="CampaignType">
            <option value="cmd">滿額折扣</option>
            <option value="csd">全館折扣</option>
        </select>
    </div>

    <div class="mb-3">
        <label>活動描述</label>
        <input type="text" class="form-control" name="CampaignDescription" />
    </div>

    <div class="mb-3">
        <label>適用商品類型</label><br />
        <input type="checkbox" name="ProductType" value="eyes" />眼睛保健
        <input type="checkbox" name="ProductType" value="skin" />皮膚護理
        <input type="checkbox" name="ProductType" value="hair" />頭髮護理
        <input type="checkbox" name="ProductType" value="face" />臉部護理
    </div>

    <div class="mb-3">
        <label>活動開始日期</label>
        <input type="date" class="form-control" name="StartDate" required />
    </div>

    <div class="mb-3">
        <label>活動結束日期</label>
        <input type="date" class="form-control" name="EndDate" />
    </div>

    <div class="mb-3">
        <label>是否啟用</label><br />
        <input type="radio" name="IsActive" value="true" checked />啟用
        <input type="radio" name="IsActive" value="false" />未啟用
    </div>

    <div class="mb-3">
        <label>活動狀態</label>
        <select class="form-select" name="Status">
            <option value="cActive">Active</option>
            <option value="cInactive">Inactive</option>
        </select>
    </div>

    <div class="mb-3">
        <label>建檔人員</label>
        <input type="number" class="form-control" name="Creator" required />
    </div>

    <div class="mb-3">
        <label>活動圖片Id</label>
        <input type="number" class="form-control" name="ImgId" />
    </div>

    <button type="button" id="submitBtn" class="btn btn-primary">確認新增</button>
</form>

@section Scripts {
    <script>
        $("#submitBtn").on("click", function(e){
            e.preventDefault();

            var data = {
                CampaignName: $("input[name='CampaignName']").val(),
                CampaignType: $("select[name='CampaignType']").val(),
                CampaignDescription: $("input[name='CampaignDescription']").val(),
                ProductType: $("input[name='ProductType']:checked").map(function(){ return this.value; }).get().join(","),
                StartDate: $("input[name='StartDate']").val() || null,
                EndDate: $("input[name='EndDate']").val() || null,
                IsActive: $("input[name='IsActive']:checked").val() === "true",
                Status: $("select[name='Status']").val(),
                Creator: parseInt($("input[name='Creator']").val()),
                ImgId: parseInt($("input[name='ImgId']").val()) || null
            };

            $.ajax({
                url: '/MKT/Campaigns/CreateCampaign',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(data),
                success: function(res){
                    if(res.success){
                        Swal.fire("成功","活動已新增！","success").then(() => {
                            window.location.href = '/MKT/Campaigns/Index';
                        });
                    } else {
                        Swal.fire("錯誤","操作失敗：" + res.message,"error");
                    }
                },
                error: function(xhr,status,error){
                    Swal.fire("錯誤","操作失敗：" + xhr.responseText,"error");
                }
            });
        });
    </script>
}
