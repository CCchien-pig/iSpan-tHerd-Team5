@* _StockBatchFormPartial.cshtml *@

@using FlexBackend.SUP.Rcl.Areas.SUP.ViewModels
@model StockBatchContactViewModel

@{
    var formAction = ViewBag.FormAction == "Edit" ?
        Url.Action("Edit", "StockBatches", new { id = Model.StockBatchId, area = "SUP" }) :
        Url.Action("CreateStockBatch", "StockBatches", new { area = "SUP" });
}

<form id="stockBatchForm" action="@formAction" method="post">
    @Html.AntiForgeryToken()

    @if (ViewBag.FormAction == "Edit")
    {
        <input type="hidden" asp-for="StockBatchId" />
    }

    <input type="hidden" id="SelectedBrandId" value="@Model.BrandId" />
    <input type="hidden" id="SelectedProductId" value="@Model.ProductId" />
    <input type="hidden" id="SelectedSkuId" value="@Model.SkuId" />
    <input type="hidden" id="SelectedMovementType" value="@Model.MovementType" />

    <div class="container-fluid">

        <!-- 品牌選擇 -->
        <div class="form-floating mb-2">
            <select class="form-select" id="BrandSelect">
                <option value="">請選品牌</option>
            </select>
            <label>品牌</label>
        </div>

        <!-- 商品選擇 -->
        <div class="form-floating mb-2">
            <select class="form-select" id="ProductSelect" disabled>
                <option value="">請選商品</option>
            </select>
            <label>商品</label>
        </div>

        <!-- SKU 選擇 -->
        <div class="form-floating mb-2">
            <select asp-for="SkuId" class="form-select" id="SkuSelect">
                <option value="">請選 SKU</option>
                @foreach (var sku in Model.SkuOptions)
                {
                    <option value="@sku.SkuId">@sku.SkuCode</option>
                }
            </select>
            <label>SKU</label>
        </div>

        <!-- 製造日期 -->
        <div class="form-floating mb-2">
            <input asp-for="ManufactureDate" id="ManufactureDate" type="date" class="form-control"
                   max="@DateTime.Now.ToString("yyyy-MM-dd")" value="@(Model.ManufactureDate?.ToString("yyyy-MM-dd") ?? "")" />
            <label>製造日期</label>
        </div>

        <!-- 唯讀庫存資訊 -->
        <div class="mb-2">
            <div>當前庫存: <span id="CurrentQty">0</span> &nbsp;|&nbsp; 預計庫存: <span id="PredictedQty">0</span></div>
            <div>最大庫存量: <span id="MaxStockQty">@Model.MaxStockQty</span></div>
            <div>再訂購點: <span id="ReorderPoint">@Model.ReorderPoint</span> &nbsp;|&nbsp; 安全庫存量: <span id="SafetyStockQty">@Model.SafetyStockQty</span></div>
            <div>是否可缺貨預購: <span id="IsAllowBackorderText"></span></div>
        </div>

        <!-- 異動類型 -->
        <div class="form-floating mb-2">
            <select asp-for="MovementType" class="form-select" id="MovementTypeSelect">
                <option value="">請選異動類型</option>
            </select>
            <label>異動類型</label>
        </div>

        <!-- 只有「加/減」選項要受 Adjust 控制 -->
        <div id="AdjustOptions" style="display:none;">
            <!-- 手動調整類型，選加/減 -->
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" asp-for="IsAdd" id="Increase" value="true">                
                <label class="form-check-label" for="Increase">增加</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" asp-for="IsAdd" id="Decrease" value="false">                
                <label class="form-check-label" for="Decrease">減少</label>
            </div>

        </div>

        <!-- 異動數量 -->
        <div class="form-floating mb-2">
            <input asp-for="ChangeQty" type="number" class="form-control" min="1"
                   max="@Model.MaxStockQty" id="ChangeQtyInput" value="@(Model.ChangeQty)" />
            <label>異動庫存量</label>
            <small id="ChangeQtyHelp" class="text-muted"></small>
        </div>


        <!-- 備註 -->
        <div class="form-floating mb-2">
            <textarea asp-for="Remark" class="form-control" placeholder="輸入備註">@Model.Remark</textarea>
            <label>備註</label>
        </div>

        <!-- 按鈕 -->
        <div class="d-flex justify-content-center mt-3">
            <button type="submit" class="btn btn-success me-2">儲存</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
        </div>
    </div>
</form>
