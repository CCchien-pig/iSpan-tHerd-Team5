@* SupStockHistories Index *@

@{
    ViewData["Title"] = "異動紀錄總表";
}

<h2>@ViewData["Title"]</h2>

<table id="stockHistoriesTable" class="table table-bordered table-striped">
    <thead>
        <tr>
            <th>SKU</th>
            <th>品牌</th>
            <th>商品名稱</th>
            <th>批號</th>
            <th>效期</th>
            <th>異動類型</th>
            <th>異動數量</th>
            <th>異動前</th>
            <th>異動後</th>
            <th>異動人員</th>
            <th>異動時間</th>
        </tr>
    </thead>
</table>

@section Scripts {
    <script>
        var table = $('#stockHistoriesTable').DataTable({
            ajax: {
                url: '/SUP/SupStockHistories/IndexJson',
                type: 'POST'
            },
            columns: [
                {
                    className: 'dt-control',
                    orderable: false,
                    data: null,
                    defaultContent: ''
                },
                { data: 'ChangedAt', title: '異動日期' },
                { data: 'RefDocumentId', title: '單據號碼' },
                { data: 'SkuCode', title: 'SKU Code' },
                { data: 'ProductName', title: '商品名稱' },
                { data: 'ChangeQty', title: '異動數量' },
                { data: 'UnitCost', title: '單位成本' },
                { data: 'TotalCost', title: '成本' },
                { data: 'ChangedBy', title: '異動人員' }
            ]
        });

        // 展開列
        $('#stockHistoriesTable tbody').on('click', 'td.dt-control', function () {
            var tr = $(this).closest('tr');
            var row = table.row(tr);

            if (row.child.isShown()) {
                row.child.hide();
                tr.removeClass('shown');
            } else {
                var d = row.data();
                var detailHtml = '<b>品牌:</b> ' + d.BrandName + '<br>' +
                                 '<b>商品名稱:</b> ' + d.ProductName + '<br>' +
                                 '<b>規格:</b> ' + d.SpecOptions.join(', ');
                row.child(detailHtml).show();
                tr.addClass('shown');
            }
        });

    </script>
}
