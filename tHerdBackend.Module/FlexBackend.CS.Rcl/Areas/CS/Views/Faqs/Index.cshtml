@model IEnumerable<FlexBackend.Infra.Models.CsFaq>

@section Styles {
    <!-- DataTables 樣式 -->
    <link href="//cdn.datatables.net/2.3.3/css/dataTables.dataTables.min.css" rel="stylesheet" />
    <link href="//cdn.datatables.net/fixedheader/4.0.3/css/fixedHeader.bootstrap.min.css" rel="stylesheet" />
    <!-- Font Awesome 圖示 -->
    <link href="~/font-awesome/css/all.min.css" rel="stylesheet" />

    <style>
        /* FAQ Table 自訂樣式 */
        #faqTable {
            font-size: 0.9rem; /* 表格字體略小 */
        }

            #faqTable th {
                background-color: #f8f9fa; /* 淺灰背景 */
                text-align: center; /* 表頭置中 */
            }

            #faqTable td {
                white-space: normal; /* 自動換行 */
                word-wrap: break-word; /* 超過寬度換行 */
                vertical-align: middle; /* 垂直置中 */
            }

            /* Action 欄位按鈕間距 */
            #faqTable .btn-group .btn {
                margin-right: 2px;
            }
    </style>
}

@{
    ViewData["Title"] = "FAQ內容管理";
}

<h1>@ViewData["Title"]</h1>

<p>
    <a asp-action="Create" class="btn btn-success">
        <i class="fa-solid fa-plus"></i> 新增Faq
    </a>
</p>

<!-- FAQ 資料表 -->
<table id="faqTable" class="table table-striped table-hover table-bordered align-middle">
    <thead>
        <tr>
            <th>@Html.DisplayNameFor(model => model.Title)</th>
            <th>@Html.DisplayNameFor(model => model.AnswerHtml)</th>
            <th>@Html.DisplayNameFor(model => model.Status)</th>
            <th>@Html.DisplayNameFor(model => model.OrderSeq)</th>
            <th>@Html.DisplayNameFor(model => model.LastPublishedTime)</th>
            <th>@Html.DisplayNameFor(model => model.IsActive)</th>
            <th>@Html.DisplayNameFor(model => model.CreatedDate)</th>
            <th>@Html.DisplayNameFor(model => model.RevisedDate)</th>
            <th>@Html.DisplayNameFor(model => model.Category)</th>
            <th>操作</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>@Html.DisplayFor(modelItem => item.Title)</td>
                <!-- 用 Raw 避免 <p> 變成文字 -->
                <td>@Html.Raw(item.AnswerHtml)</td>
                <td>@Html.DisplayFor(modelItem => item.Status)</td>
                <td>@Html.DisplayFor(modelItem => item.OrderSeq)</td>
                <td>@Html.DisplayFor(modelItem => item.LastPublishedTime)</td>
                <td>@Html.DisplayFor(modelItem => item.IsActive)</td>
                <td>@Html.DisplayFor(modelItem => item.CreatedDate)</td>
                <td>@Html.DisplayFor(modelItem => item.RevisedDate)</td>
                <td>@Html.DisplayFor(modelItem => item.Category.CategoryName)</td>
                <td>
                    <!-- 這裡的 Action 先保留，DataTables 會把它美化 -->
                    <a asp-action="Edit" asp-route-id="@item.FaqId">Edit</a> |
                    <a asp-action="Details" asp-route-id="@item.FaqId">Details</a> |
                    <a asp-action="Delete" asp-route-id="@item.FaqId">Delete</a>
                </td>
            </tr>
        }
    </tbody>
</table>

@section Scripts {
    <!-- jQuery (DataTables 必須先載入 jQuery) -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <!-- Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- DataTables 核心 -->
    <script src="//cdn.datatables.net/2.3.3/js/dataTables.min.js"></script>
    <!-- DataTables 固定表頭套件 -->
    <script src="//cdn.datatables.net/fixedheader/4.0.3/js/dataTables.fixedHeader.min.js"></script>

    <script>
        $(document).ready(function () {
            new DataTable('#faqTable', {
                fixedHeader: true,   // 表頭固定
                paging: true,        // 顯示分頁
                searching: true,     // 顯示搜尋框
                ordering: true,      // 欄位排序
                responsive: true,    // RWD 支援
                scrollY: "60vh",     // 表格高度 (視窗 60%)
                scrollCollapse: true, // 捲動時收合
                language: {
                    url: "//cdn.datatables.net/plug-ins/1.13.6/i18n/zh-HANT.json" // 中文化
                },
                columnDefs: [
                    {
                        targets: 1, // AnswerHtml 欄位
                        render: function (data) {
                            // 取出純文字，避免顯示 HTML tag
                            let text = $(data).text();
                            // 超過 50 字就顯示省略號
                            return text.length > 50 ? text.substring(0, 50) + "..." : text;
                        }
                    },
                    {
                        targets: 5, // IsActive 欄位
                        render: function (data) {
                            // 改用 Badge 顯示狀態
                            return data === "true" || data === true
                                ? '<span class="badge bg-success">啟用</span>'
                                : '<span class="badge bg-secondary">停用</span>';
                        }
                    },
                    {
                        targets: -1, // Action 欄位 (最後一欄)
                        orderable: false,  // 不允許排序
                        searchable: false  // 不加入搜尋
                    }
                ]
            });
        });
    </script>
}
