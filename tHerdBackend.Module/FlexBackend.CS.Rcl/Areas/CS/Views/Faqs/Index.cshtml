@model IEnumerable<FlexBackend.Infra.Models.CsFaq>
@{
    ViewData["Title"] = "FAQ 管理台";
}

@section Styles {
    <!-- DataTables × Bootstrap 5 -->
    <link href="//cdn.datatables.net/2.3.3/css/dataTables.bootstrap5.min.css" rel="stylesheet" />
    <link href="//cdn.datatables.net/fixedheader/4.0.3/css/fixedHeader.bootstrap5.min.css" rel="stylesheet" />
    <!-- Font Awesome（沿用你的風格） -->
    <link href="~/font-awesome/css/all.min.css" rel="stylesheet" />
    <style>
        .btn-seg .btn {
            min-width: 8rem;
        }

        .tab-pane {
            padding-top: .75rem;
        }

        .table-sm > :not(caption) > * > * {
            padding: .5rem .6rem;
        }

        .table-clean > :not(caption) > * > * {
            border-bottom-color: #eee;
        }

        .btn-icon {
            width: 2rem;
            height: 2rem;
            padding: 0;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: .5rem;
        }

        .switch-wrap {
            gap: .4rem;
        }

        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
}

<h1 class="h4 mb-3">@ViewData["Title"]</h1>

<!-- 三顆切換鈕 -->
<!-- 切換按鈕 -->
<div class="btn-group btn-seg mb-3" role="tablist" aria-label="切換">
    <button type="button" class="btn btn-primary active" data-bs-toggle="tab" data-bs-target="#pane-faq" aria-selected="true">FAQ 主表</button>
    <button type="button" class="btn btn-outline-primary" data-bs-toggle="tab" data-bs-target="#pane-cat" aria-selected="false">FAQ 分類</button>
    <button type="button" class="btn btn-outline-primary" data-bs-toggle="tab" data-bs-target="#pane-kw" aria-selected="false">FAQ 關鍵字</button>
</div>

<!-- Tab 內容 -->
<div class="tab-content">
    <div class="tab-pane fade show active" id="pane-faq" role="tabpanel">
        <h4>FAQ 主表內容</h4>
        <p>這裡放 FAQ 主表的功能模組</p>
        @* 可以用 PartialView 或 DataTable *@
    </div>

    <div class="tab-pane fade" id="pane-cat" role="tabpanel">
        <h4>FAQ 分類內容</h4>
        <p>這裡放 FAQ 分類管理功能模組</p>
        @* 呼叫 /CS/FaqCategories/Index *@
    </div>

    <div class="tab-pane fade" id="pane-kw" role="tabpanel">
        <h4>FAQ 關鍵字內容</h4>
        <p>這裡放 FAQ 關鍵字管理功能模組</p>
        @* 呼叫 /CS/FaqKeywords/Index *@
    </div>
</div>



<!-- Anti-forgery：所有 AJAX 會用到 -->
<form id="antiForgeryForm" method="post">@Html.AntiForgeryToken()</form>

<!-- 三個分頁：第一次顯示時才 AJAX 載入 Partial -->
<div class="tab-content">
    <div class="tab-pane fade show active" id="pane-faq"
         data-url="@Url.Action("IndexPartial", "Faqs", new { area = "CS" })"></div>

    <div class="tab-pane fade" id="pane-cat"
         data-url="@Url.Action("IndexPartial", "FaqCategories", new { area = "CS" })"></div>

    <div class="tab-pane fade" id="pane-kw"
         data-url="@Url.Action("IndexPartial", "FaqKeywords", new { area = "CS" })"></div>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="//cdn.datatables.net/2.3.3/js/dataTables.min.js"></script>
    <script src="//cdn.datatables.net/2.3.3/js/dataTables.bootstrap5.min.js"></script>
    <script src="//cdn.datatables.net/fixedheader/4.0.3/js/dataTables.fixedHeader.min.js"></script>

    <script>
        (function(){
          const antiToken = $('#antiForgeryForm input[name="__RequestVerificationToken"]').val();

          // 載入分頁對應的 Partial（僅一次）
          const loadPane = (selector) => {
              const $pane = $(selector);
              if ($pane.data('loaded')) return;
              const url = $pane.data('url');
              $pane.load(url, function(){
                  $pane.data('loaded', true);
                  const fnName = $pane.find('[data-init]').data('init'); // e.g. initFaqTable
                  if (typeof window[fnName] === 'function') window[fnName](antiToken);
              });
          };

          // 預設載 FAQ 主表
          loadPane('#pane-faq');

          // 切換才載入其它 Partial
          document.querySelectorAll('[data-bs-toggle="tab"]').forEach(btn=>{
              btn.addEventListener('shown.bs.tab', (e)=>{
                  const pane = e.target.getAttribute('data-bs-target');
                  loadPane(pane);
                  // 切換鈕樣式
                  document.querySelectorAll('.btn-seg .btn')
                    .forEach(b=>b.classList.replace('btn-primary','btn-outline-primary'));
                  e.target.classList.replace('btn-outline-primary','btn-primary');
              });
          });

          // 提供給各 partial 初始化 tooltip
          window.__initTooltips = () => {
              document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(el=>{
                  const t = bootstrap.Tooltip.getInstance(el); if (t) t.dispose();
                  new bootstrap.Tooltip(el);
              });
          };
        })();
    </script>
}
