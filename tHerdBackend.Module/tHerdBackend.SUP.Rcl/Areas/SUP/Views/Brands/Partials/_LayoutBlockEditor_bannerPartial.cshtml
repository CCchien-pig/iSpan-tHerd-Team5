@* 摺疊內容(_LayoutBlockEditor_accordionPartial.cshtml) *@
@model tHerdBackend.SUP.Rcl.Areas.SUP.ViewModels.BrandLayoutBlockViewModel

@using System.Text.Json;
@using tHerdBackend.Core.DTOs.SUP.BrandLayoutBlocks

@{
    // 這裡假設您在 Controller 的 GetLayoutBlockPartial Action 中設置了 ViewData["Index"]
    var index = ViewData["Index"] as int? ?? 0;

    // 【修正點：二次反序列化】將通用的 Model.Props 轉換為強型別 AccordionPropsDto
    AccordionPropsDto? accordionProps = null;

    try
    {
        var propsJson = JsonSerializer.Serialize(Model.Props);
        accordionProps = JsonSerializer.Deserialize<AccordionPropsDto>(propsJson,
            new JsonSerializerOptions { PropertyNamingPolicy = JsonNamingPolicy.CamelCase });
    }
    catch (Exception)
    {
        // 反序列化失敗時，保持 accordionProps 為 null
    }
}

<div class="layout-block-item bg-white p-3 mb-3 shadow-sm rounded"
        data-block-type="accordion"
        data-block-id="@Model.Id">

    <div class="block-header d-flex justify-content-between align-items-center bg-warning-subtle p-2 mb-2 rounded" style="cursor: grab;">
        <span class="fw-bold">區塊 @(index + 1)：[摺疊內容]</span>
        @* 注意：這是 jQuery 移除按鈕，在 Vue 編輯器中應使用 Vue 的 removeBlock 函式 *@
        <button type="button" class="btn btn-sm btn-outline-danger" onclick="$(this).closest('.layout-block-item').remove()">移除</button>
    </div>

    @if (accordionProps != null)
    {
        <div class="mb-3">
            <label class="form-label">摺疊標題</label>
            @* 【修正】使用強型別 accordionProps 存取 Title *@
            <input type="text" class="form-control prop-title" value="@accordionProps.Title" placeholder="例如：品牌精神或常見問題" />
        </div>
        <div class="mb-3">
            <label class="form-label">摺疊內容 (支援 HTML)</label>
            @* 【修正】使用強型別 accordionProps 存取 Content *@
            <textarea class="form-control prop-content" rows="4">@accordionProps.Content</textarea>
        </div>
        @* TODO: 圖片選擇 (ImgId) 的欄位 *@
    }
    else
    {
        <div class="alert alert-warning">
            警告：無法解析 Accordion 屬性資料。請檢查 JSON 結構是否正確。
        </div>
    }
</div>