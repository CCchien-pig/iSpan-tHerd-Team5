@model FlexBackend.Infra.Models.MktCoupon

<div class="modal fade" id="editCouponModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form id="editCouponForm">
                <div class="modal-header">
                    <h5 class="modal-title">編輯優惠券</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    
                        <div class="mb-3">
                            <label class="form-label">優惠券 ID</label>
                            <input type="text" id="editCouponId" name="CouponId" class="form-control" readonly />
                        </div>
                    
                    

                    <!-- 活動ID 下拉選單 -->
                    <div class="mb-3">
                        <label class="form-label">活動</label>
                        <select name="CampaignId" id="editCampaignId" class="form-select" required>
                            <option value="">請選擇活動</option>
                            @foreach (var c in ViewBag.Campaigns)
                            {
                                var start = c.StartDate.ToString("MM/dd");
                                var end = c.EndDate?.ToString("MM/dd") ?? "";
                                <option value="@c.CampaignId"
                                        data-start="@c.StartDate.ToString("yyyy-MM-ddTHH:mm")"
                                        data-end="@(c.EndDate?.ToString("yyyy-MM-ddTHH:mm") ?? "")">
                                    @c.CampaignName (@start ~ @end)
                                </option>
                            }
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">規則</label>
                        <select id="editRuleId" name="RuleId" class="form-select"></select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">優惠券名稱</label>
                        <input type="text" id="editCouponName" name="CouponName" class="form-control" required />
                    </div>

                    <div class="mb-3">
                        <label class="form-label">優惠券代碼</label>
                        <input type="text" id="editCouponCode" name="CouponCode" class="form-control" required />
                    </div>

                    @* <div class="mb-3">
                        <label class="form-label">狀態</label> *@
                        <input type="hidden" id="editStatus" name="Status" class="form-control" value="pActive" />
                    @* </div> *@

                    <div class="mb-3">
                        <label class="form-label">開始日期</label>
                        <input type="datetime-local" id="editStartDate" name="StartDate" class="form-control"  />
                    </div>

                    <div class="mb-3">
                        <label class="form-label">結束日期</label>
                        <input type="datetime-local" id="editEndDate" name="EndDate" class="form-control"  />
                    </div>

                    <div class="mb-3">
                        <label class="form-label">折扣金額</label>
                        <input type="number" id="editDiscountAmount" name="DiscountAmount" class="form-control" />
                    </div>

                    @* <div class="mb-3">
                        <label class="form-label">折扣百分比</label> *@
                        <input type="hidden" id="editDiscountPercent" name="DiscountPercent" class="form-control" value=""/>
                    @* </div> *@

                    <div class="mb-3">
                        <label class="form-label">總數量</label>
                        <input type="number" id="editTotQty" name="TotQty" class="form-control" />
                    </div>

                    <div class="mb-3">
                        <label class="form-label">每人限領</label>
                        <input type="number" id="editUserLimit" name="UserLimit" class="form-control" />
                    </div>

                    @* <div class="mb-3" ty>
                        <label class="form-label">有效時數</label> *@
                        <!-- 隱藏 有效時數，固定傳回 1 -->
                        <input type="hidden" id="editValidHours" name="ValidHours" value="1" />
                    @* </div> *@

                    <div class="form-check form-switch mb-3">
                        <input type="checkbox" id="editIsActive" name="IsActive" class="form-check-input" />
                        <label class="form-check-label" for="editIsActive">啟用</label>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">建立者</label>
                        <input type="number" id="editCreator" name="Creator" class="form-control" />
                    </div>

                    <!-- 建立日期 (隱藏，但保留值) -->
                    <input type="hidden" id="editCreatedDate" name="CreatedDate"
                           value='@Html.Raw(Model != null && Model.CreatedDate != default(DateTime)
                                                           ? Model.CreatedDate.ToString("yyyy-MM-dd HH:mm")
                                                           : "")' />



                </div>
                <div class="modal-footer">
                    <button type="button" id="saveCouponBtn" class="btn btn-primary">儲存</button>
                    <button type="button" id="deleteCouponBtn" class="btn btn-danger">刪除</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                </div>
            </form>
        </div>
    </div>
</div>
<script>
    function formatDateTime(dt) {
        if (!dt) return "";
        const d = new Date(dt);
        return d.getFullYear() + "-" +
               String(d.getMonth() + 1).padStart(2, "0") + "-" +
               String(d.getDate()).padStart(2, "0") + " " +
               String(d.getHours()).padStart(2, "0") + ":" +
               String(d.getMinutes()).padStart(2, "0");
    }
</script>