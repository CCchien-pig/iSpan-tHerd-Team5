@using FlexBackend.SUP.Rcl.Areas.SUP.Controllers
@using FlexBackend.SUP.Rcl.Areas.SUP.ViewModels

@* _StockBatchSalePartial.cshtml，給 銷售出庫 / 退貨入庫 / 到期報廢 *@

@model StockBatchContactViewModel

@{
    var formAction = ViewBag.FormAction switch
    {
        "Sale" => Url.Action("SaleStock", "StockBatches", new { area = "SUP" }),
        "Return" => Url.Action("ReturnStock", "StockBatches", new { area = "SUP" }),
        "Expire" => Url.Action("ExpireStock", "StockBatches", new { area = "SUP" }),
        _ => "#"
    };
}

<form id="saleStockBatchForm" action="@formAction" method="post">
    @Html.AntiForgeryToken()

    <input type="hidden" asp-for="SkuId" id="SaleSelectedSkuId" value="@Model.SkuId" />
    <input type="hidden" asp-for="MovementType" id="SaleSelectedMovementType" value="@Model.MovementType" />

    <div class="container-fluid">

        <!-- 品牌選擇 -->
        <div class="form-floating mb-2">
            <select class="form-select" id="SaleBrandSelect">
                <option value="">請選品牌</option>
            </select>
            <label>品牌</label>
        </div>

        <!-- 商品選擇 -->
        <div class="form-floating mb-2">
            <select class="form-select" id="SaleProductSelect" disabled>
                <option value="">請選商品</option>
            </select>
            <label>商品</label>
        </div>

        <!-- SKU 選擇 -->
        <div class="form-floating mb-2">
            <select asp-for="SkuId" class="form-select" id="SaleSkuSelect">
                <option value="">請選 SKU</option>
                @foreach (var sku in Model.SkuOptions)
                {
                    <option value="@sku.SkuId">@sku.SkuCode</option>
                }
            </select>
            <label>SKU</label>
        </div>

        <!-- 唯讀庫存資訊 -->
        <div class="mb-2">
            <div>當前庫存: <span id="SaleCurrentQty">0</span> &nbsp;|&nbsp; 預計庫存: <span id="SalePredictedQty">0</span></div>
            <div>最大庫存量: <span id="SaleMaxStockQty">@Model.MaxStockQty</span></div>
            <div>再訂購點: <span id="SaleReorderPoint">@Model.ReorderPoint</span> &nbsp;|&nbsp; 安全庫存量: <span id="SaleSafetyStockQty">@Model.SafetyStockQty</span></div>
        </div>

        <!-- 異動類型 -->
        <div class="form-floating mb-2">
            <select asp-for="MovementType" class="form-select saleMovementTypeSelect" id="SaleMovementTypeSelect">
                <option value="">請選異動類型</option>
            </select>
            <label>異動類型</label>
        </div>

        <!-- 異動數量 -->
        <div class="form-floating mb-2">
            <input asp-for="ChangeQty" type="number" class="form-control" min="1" step="1"
                   id="SaleChangeQtyInput" value="@(Model.ChangeQty ?? 1)" />
            <label>異動庫存量</label>
            <small id="SaleChangeQtyHelp" class="text-muted"></small>
        </div>

        <!-- 備註 -->
        <div class="form-floating mb-2">
            <textarea asp-for="Remark" class="form-control" placeholder="輸入備註" id="SaleRemark">@Model.Remark</textarea>
            <label>備註</label>
        </div>

        <!-- 按鈕 -->
        <div class="d-flex justify-content-center mt-3">
            <button type="submit" class="btn btn-success me-2">儲存</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
        </div>

    </div>
</form>